const MainBundle=function(){function t(){this.selector={forms:document.querySelectorAll("form.bundle-item-form"),addeditemscontainer:document.querySelector("[data-cart-bundle-items]"),itemtemplate:document.getElementById("cart-bundle-item"),footerbundletitle:document.querySelector("[data-footer-bundle-title]"),footertext:document.querySelector("[data-footer-text]"),main:document.getElementById("main-bundle"),footercalltoaction:document.querySelector("[data-footer-call-to-action]"),addtocart:document.querySelector("[data-add-to-cart]"),totalcompareatprice:document.querySelector("[data-total-compare-at-price]"),totaldiscountedprice:document.querySelector("[data-total-discount-price]"),selectvariants:document.querySelectorAll('select[name="item_variant_options"]')},this.state={bundleitems:[]},this.load()}t.prototype.load=function(){var t=this;t.selector.forms.length>0&&t.selector.forms.forEach(e=>{e.addEventListener("submit",e=>{if(e.preventDefault(),t.animatecheck(e.target.querySelector("button")),t.state.bundleitems.length>0){if(t.state.bundleitems=t.state.bundleitems.map(t=>parseInt(t.id)==parseInt(e.target.item_variant_options.options[e.target.item_variant_options.selectedIndex].value)?{...t,qty:t.qty+1}:t),t.state.bundleitems.some(t=>parseInt(t.id)==parseInt(e.target.item_variant_options.options[e.target.item_variant_options.selectedIndex].value))){let a=t.selector.addeditemscontainer.querySelector(`[data-item-variant-id="${e.target.item_variant_options.options[e.target.item_variant_options.selectedIndex].value}"]`);a&&t.state.bundleitems.map(t=>{parseInt(t.id)==parseInt(e.target.item_variant_options.options[e.target.item_variant_options.selectedIndex].value)&&(a.textContent=t.qty)})}else{t.state.bundleitems.push({id:e.target.item_variant_options.options[e.target.item_variant_options.selectedIndex].value,qty:1,price:e.target.item_variant_options.options[e.target.item_variant_options.selectedIndex].dataset.variantPrice,discounted_price:e.target.item_variant_options.options[e.target.item_variant_options.selectedIndex].dataset.variantDiscountedPrice});let i=t.selector.itemtemplate.content;i.querySelector("[data-item-image]").src=e.target.item_image.value,i.querySelector("[data-item-title]").textContent=`${e.target.item_title.value} - ${e.target.item_variant_options.options[e.target.item_variant_options.selectedIndex].dataset.variantTitle}`,i.querySelector("[data-item-url").href=e.target.item_url.value,i.querySelector("[data-variant-id]").dataset.variantId=e.target.item_variant_options.options[e.target.item_variant_options.selectedIndex].value,i.querySelector("[data-item-variant-id]").dataset.itemVariantId=e.target.item_variant_options.options[e.target.item_variant_options.selectedIndex].value,t.selector.addeditemscontainer.appendChild(document.importNode(i,!0))}}else{t.state.bundleitems.push({id:e.target.item_variant_options.options[e.target.item_variant_options.selectedIndex].value,qty:1,price:e.target.item_variant_options.options[e.target.item_variant_options.selectedIndex].dataset.variantPrice,discounted_price:e.target.item_variant_options.options[e.target.item_variant_options.selectedIndex].dataset.variantDiscountedPrice});let o=t.selector.itemtemplate.content;o.querySelector("[data-item-image]").src=e.target.item_image.value,o.querySelector("[data-item-title]").textContent=`${e.target.item_title.value} - ${e.target.item_variant_options.options[e.target.item_variant_options.selectedIndex].dataset.variantTitle}`,o.querySelector("[data-item-url").href=e.target.item_url.value,o.querySelector("[data-variant-id]").dataset.variantId=e.target.item_variant_options.options[e.target.item_variant_options.selectedIndex].value,o.querySelector("[data-item-variant-id]").dataset.itemVariantId=e.target.item_variant_options.options[e.target.item_variant_options.selectedIndex].value,t.selector.addeditemscontainer.appendChild(document.importNode(o,!0))}t.limitvalidation()})}),t.selector.addeditemscontainer&&t.selector.addeditemscontainer.addEventListener("click",async e=>{e.target.closest(".close")&&(t.state.bundleitems.length>0&&(t.state.bundleitems=t.state.bundleitems.filter(t=>parseInt(t.id)!==parseInt(e.target.closest(".close").dataset.variantId))),e.target.closest(".bundle-item").remove()),t.limitvalidation()}),t.selector.addtocart&&t.selector.addtocart.addEventListener("click",e=>{e.target.closest("button").classList.add("active"),t.addtocart(e.target.closest("button"))}),t.selector.selectvariants.length>0&&t.selector.selectvariants.forEach(t=>{t.addEventListener("change",t=>{t.target.closest("form").querySelector(".compare-at-price").textContent=t.target.options[t.target.selectedIndex].dataset.variantPrice,t.target.closest("form").querySelector(".regular-price").textContent=t.target.options[t.target.selectedIndex].dataset.variantDiscountedPrice,"true"===t.target.options[t.target.selectedIndex].dataset.variantAvailable?t.target.closest("form").querySelector("button").type="submit":t.target.closest("form").querySelector("button").type="button","true"===t.target.options[t.target.selectedIndex].dataset.variantAvailable?t.target.closest("form").querySelector("button > .title").textContent="Add to cart":t.target.closest("form").querySelector("button > .title").textContent="Out of stock"})})},t.prototype.limitvalidation=function(){var t=this;if(t.state.bundleitems.length>0){t.selector.footerbundletitle.classList.add("active");let e=0,a=0,i=0;t.state.bundleitems.map(t=>{e+=parseInt(t.qty),a+=parseFloat(t.price.replace(/[^0-9.]/g,"")),i+=parseFloat(t.discounted_price.replace(/[^0-9.]/g,""))});let o=a.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,","),r=i.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",");parseInt(t.selector.main.dataset.quantityLimit)>e?(t.selector.footertext.classList.add("active"),t.selector.footercalltoaction.classList.remove("active"),t.selector.footertext.textContent=`Your bundle needs ${parseInt(t.selector.main.dataset.quantityLimit)-e} more item(s)`):(t.selector.footertext.classList.remove("active"),t.selector.footercalltoaction.classList.add("active"),t.selector.totalcompareatprice.textContent=`${t.selector.main.dataset.currentCurrency}${o}`,t.selector.totaldiscountedprice.textContent=`${t.selector.main.dataset.currentCurrency}${r}`)}else t.selector.footertext.textContent=`Your bundle needs ${parseInt(t.selector.main.dataset.quantityLimit)} more item(s)`,t.selector.footertext.classList.add("active"),t.selector.footerbundletitle.classList.remove("active"),t.selector.footercalltoaction.classList.remove("active")},t.prototype.addtocart=async function(t){let e={items:[]};this.state.bundleitems.length>0&&(this.state.bundleitems.map(t=>{e.items.push({id:parseInt(t.id),quantity:parseInt(t.qty)})}),await fetch(window.Shopify.routes.root+"cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(t=>t.json()).then(e=>{t.classList.remove("active")}).catch(t=>{console.error("Error:",t)}).finally(()=>{window.location.href="/cart"}))},t.prototype.animatecheck=function(t){t.classList.add("active"),t.querySelector(".check-mark").addEventListener("animationend",()=>{t.classList.remove("active")})},t=new t};MainBundle();